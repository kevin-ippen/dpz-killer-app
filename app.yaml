# Databricks Apps Configuration
#
# This file configures your application for deployment to Databricks Apps.
# For more information, see: https://docs.databricks.com/en/dev-tools/databricks-apps/index.html

# Command to start the application
# Note: uvicorn will serve both API and frontend static files
command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

# Resource configuration (optional)
# Uncomment and adjust based on your needs
# resources:
#   memory: "2Gi"
#   cpu: "1"

# Unity Catalog permissions
# Grant the app service principal access to UC resources
resources:
  uc_securable:
    # Grant READ access to dominos_analytics schema
    - securable_type: SCHEMA
      securable_full_name: main.dominos_analytics
      privilege: SELECT

    # Grant READ access to dominos_realistic schema
    - securable_type: SCHEMA
      securable_full_name: main.dominos_realistic
      privilege: SELECT

    # Grant access to LLM serving endpoint
    - securable_type: SERVING_ENDPOINT
      securable_full_name: databricks-gpt-oss-120b
      privilege: EXECUTE

# Environment variables
# Databricks auto-injects these variables for authentication
env:
  - name: DATABRICKS_HOST
    value: ${workspace.host}
  - name: DATABRICKS_TOKEN
    value: ${workspace.token}
  - name: DATABRICKS_HTTP_PATH
    value: /sql/1.0/warehouses/148ccb90800933a1
  - name: CATALOG
    value: main
  - name: SCHEMA
    value: dominos_analytics
  - name: LLM_ENDPOINT
    value: https://adb-984752964297111.11.azuredatabricks.net/serving-endpoints/databricks-gpt-oss-120b/invocations
  - name: LLM_MODEL_NAME
    value: databricks-gpt-oss-120b
